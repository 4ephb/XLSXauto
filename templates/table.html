{% extends 'base.html' %}

{% block content %}
<div class="container">
  <h1>Таблица</h1>
  <table id="table" class="table table-striped table-bordered">
    <thead>
      <tr>
        {% for column in data[0].keys() %}
        <th>{{ column }}</th>
        {% endfor %}
      </tr>
    </thead>
    <tbody>
      {% for row in data %}
      <tr>
        {% for key, value in row.items() %}
        <td data-row="{{ loop.index0 }}" data-column="{{ key }}" contenteditable>{{ value }}</td>
        {% endfor %}
      </tr>
      {% endfor %}
    </tbody>
  </table>
  <button id="save" class="btn btn-primary">Сохранить</button>
</div>

<script>
$(document).ready(function() {
  var table = $('#table').DataTable({
    paging: false,
    searching: false,
    info: false
  });

  $('#table').on('blur', 'td[contenteditable]', function() {
    var row = $(this).data('row');
    var column = $(this).data('column');
    var value = $(this).text();
    $.ajax({
      url: '/update_cell',
      type: 'POST',
      contentType: 'application/json',
      data: JSON.stringify({
        file_path: '{{ file_path }}',
        row: row,
        column: column,
        value: value
      })
    });
  });

  $('#save').click(function() {
    window.location.href = '{{ url_for("static", filename=file_path) }}';
  });
});
</script>
{% endblock %}
